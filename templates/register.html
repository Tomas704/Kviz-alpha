{% extends 'layout.html' %}

{% block title %}
  Registrácia nového používateľa
{% endblock %}

{% block content %}
<div class="row">
  <div class="col-md-8 offset-md-2 col-lg-6 offset-lg-3">
    <div class="card shadow-sm">
      <div class="card-body p-4">
        <h2 class="card-title text-center mb-4">Vytvoriť účet</h2>
        
        <form method="POST" action="" novalidate>
          
          {{ form.hidden_tag() }}

          <div class="mb-3">
            {{ form.username.label(class="form-label") }}
            {{ form.username(class="form-control" + (" is-invalid" if form.username.errors else "")) }}
            {% if form.username.errors %}
              <div class="invalid-feedback">
                {% for error in form.username.errors %}
                  <span>{{ error }}</span>
                {% endfor %}
              </div>
            {% endif %}
          </div>

          <div class="mb-3">
            {{ form.password.label(class="form-label") }}
            <div class="input-group">
              {{ form.password(class="form-control" + (" is-invalid" if form.password.errors else ""), id="password") }}
              <button class="btn btn-outline-secondary toggle-password-btn" type="button" data-target-input="password">
                  <i class="bi bi-eye-slash"></i>
              </button>
              {% if form.password.errors %}
                <div class="invalid-feedback d-block"> {% for error in form.password.errors %}
                    <span>{{ error }}</span>
                  {% endfor %}
                </div>
              {% endif %}
            </div>
          </div>

          <div class="mb-3">
            {{ form.confirm_password.label(class="form-label") }}
            <div class="input-group">
              {{ form.confirm_password(class="form-control" + (" is-invalid" if form.confirm_password.errors else ""), id="confirm_password") }}
              <button class="btn btn-outline-secondary toggle-password-btn" type="button" data-target-input="confirm_password">
                  <i class="bi bi-eye-slash"></i>
              </button>
              {% if form.confirm_password.errors %}
                <div class="invalid-feedback d-block">
                  {% for error in form.confirm_password.errors %}
                    <span>{{ error }}</span>
                  {% endfor %}
                </div>
              {% endif %}
            </div>
          </div>

          <div class="d-grid gap-2 mt-4">
            {{ form.submit(class="btn btn-primary btn-lg") }}
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}


{% block scripts %}
<script>
  // Spustí sa, až keď je celá stránka načítaná
  document.addEventListener('DOMContentLoaded', function() {
    
    // Nájdi VŠETKY tlačidlá, ktoré majú triedu '.toggle-password-btn'
    const toggleButtons = document.querySelectorAll('.toggle-password-btn');

    // Prejdi každé nájdené tlačidlo
    toggleButtons.forEach(function(button) {
      
      // Pridaj mu "listener" na kliknutie
      button.addEventListener('click', function() {
        
        // Zisti ID cieľového inputu, ktoré sme si uložili do 'data-target-input'
        const targetInputId = button.dataset.targetInput;
        const targetInput = document.getElementById(targetInputId);

        // Nájdi ikonu vnútri tlačidla
        const icon = button.querySelector('i');

        // Zisti aktuálny typ inputu
        if (targetInput.type === 'password') {
          // Zmeň ho na text
          targetInput.type = 'text';
          // Zmeň ikonu na "otvorené oko"
          icon.classList.remove('bi-eye-slash');
          icon.classList.add('bi-eye');
        } else {
          // Zmeň ho naspäť na heslo
          targetInput.type = 'password';
          // Zmeň ikonu na "zatvorené oko"
          icon.classList.remove('bi-eye');
          icon.classList.add('bi-eye-slash');
        }
      });
    });
  });
</script>
{% endblock %}